
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>2.1. Software Architecture &#8212; ShakeMap Documentation  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/northridge_points.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2.2. Data Processing" href="tg_processing.html" />
    <link rel="prev" title="2. Technical Guide" href="technical_guide.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="software-architecture">
<span id="sec-architecute-4"></span><h1>2.1. Software Architecture<a class="headerlink" href="#software-architecture" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>2.1.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>ShakeMap 4.0 is designed to allow flexibility in the organization of
computing resources. <a class="pageref" href="#architecture-overview">Figure  1</a> illustrates an
idealized implementation where data preparation, processing, and rendering
all take place within separate computational units. The processing
sequence starts when an earthquake is identified and a decision is made
to produce a ShakeMap. The process <strong>shake assemble</strong>
collects the available information about the event (origin and rupture
parameters, seismic data, etc.) as well as ShakeMap configuration
information (which may include information about the event’s
seismotectonic regime and related choices about GMPE selection), and
produces a file, <em>shake_data.hdf</em>, containing all of these parameters. This
file may be injected into a messaging system, but may also be used locally
by subsequent processes.</p>
<div class="figure align-left" id="id2">
<span id="architecture-overview"></span><a class="reference internal image-reference" href="../_images/sm4.png"><img alt="../_images/sm4.png" src="../_images/sm4.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-text">Figure 1: Overview of ShakeMap architecture.</span></p>
</div>
<p>The processing continues when <em>shake_data.hdf</em> becomes available. The ShakeMap
process <strong>shake model</strong> reads <em>shake_data.hdf</em> and produces output in the file
<em>shake_result.hdf</em>. This result can then be fed into a messaging system for
delivery to consumers. Some consumers, however, have more sophisticated
requirements than can be accommodated by simply processing <em>shake_result.hdf</em>
or other generic ShakeMap products.
ShakeCast <a class="reference internal" href="references.html#wald2008shakecast"><span class="std std-ref">(Wald et al., 2008)</span></a>, for example, requires
ground motions at a variety of spectral periods and at specific locations that
may not fall on or within the grid produced by the authoritative ShakeMap
system. ShakeCast operators may also have data not available to the
authoritative system. Remote processing systems can receive <em>shake_data.hdf</em>
from a messaging system, and run the program <strong>shake augment</strong> to add their own
data and configuration choices to those contained in <em>shake_data.hdf</em>
(see <a class="pageref" href="#shake-consumer">Figure  2</a>). They may then run <strong>shake model</strong> to
generate a <em>shake_result.hdf</em> specific to their needs.</p>
<div class="figure align-left" id="id3">
<span id="shake-consumer"></span><a class="reference internal image-reference" href="../_images/consumer.png"><img alt="../_images/consumer.png" src="../_images/consumer.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-text">Figure 2: An example of a consumer of the <em>shake_data.hdf</em> product.</span></p>
</div>
<p>Rendering begins when <em>shake_result.hdf</em> becomes available. A set of modules
exist (or may be developed) to read <em>shake_result.hdf</em> and produce the variety
of products for which ShakeMap is known.
These <strong>shake</strong> modules may produce
the products locally (i.e., by the same system that generates <em>shake_result.hdf</em>)
and transfer them to consumers via a messaging system or other means.</p>
<p>An alternative approach, however, is to create a web service that delivers
the products when they are requested. This approach is illustrated in
<a class="pageref" href="#shake-web">Figure  3</a>. When the website is notified of the existence
of <em>shake_result.hdf</em>, it can begin the process of creating a “page” for the
event. It requests any necessary products from the web service, which in turn
generates those products from <em>shake_result.hdf</em> (via <strong>shake</strong> modules). As
products are needed (e.g., from users viewing or requesting downloads) they
are produced on the fly by the web service. Once generated, products may be
cached by the web system to improve performance.</p>
<div class="figure align-left" id="id4">
<span id="shake-web"></span><a class="reference internal image-reference" href="../_images/web.png"><img alt="../_images/web.png" src="../_images/web.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-text">Figure 3: An example of a website using a web service to retrieve products. The web
service produces products from <em>shake_result.hdf</em>.</span></p>
</div>
<p>Any combination of these approaches (i.e., producing products locally or via a
web service) may be developed (e.g., the web service may be designed to collect
a subset of ShakeMap products available through a messaging system and deliver
them when requested, rather than producing them itself). Thus, the same set of
constituent modules are needed, whether the products are delivered directly by
the authoritative ShakeMap system or through a web service.</p>
</div>
<div class="section" id="programs">
<h2>2.1.2. Programs<a class="headerlink" href="#programs" title="Permalink to this headline">¶</a></h2>
<p>The core components of ShakeMap are a set of command line programs.
These
programs allow the operator to set up a ShakeMap environment, collect
data and configurations into inputs (i.e., <em>shake_data.hdf</em>), and
generate ShakeMap grids and their associated products.</p>
<div class="section" id="sm-profile">
<h3>2.1.2.1. sm_profile<a class="headerlink" href="#sm-profile" title="Permalink to this headline">¶</a></h3>
<p>The user will need to run <strong>sm_profile</strong> at least once to create a
ShakeMap
environment, referred to as a ‘profile.’ This environment consists of two
directories – one for
event data, and another for configuration files and associated support
products (Vs30 grid, geographic features, etc.) – and a configuration
file that points to them. The profile data resides in a file called
<em>profiles.conf</em> in a subdirectory, <em>.shakemap</em>, of the user’s home
directory. The user may choose another location for the profile file
by using the <code class="docutils literal"><span class="pre">-f</span></code> option to <strong>sm_profile</strong>. Other ShakeMap programs
read the profile information and use it to find event and
configuration information.</p>
<p>The data directory (‘&lt;data_dir&gt;’) contains event subdirectories (named
with their event IDs) and their associated subdirectories:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">data_dir</span><span class="o">&gt;/</span>
    <span class="o">&lt;</span><span class="n">event_id_1</span><span class="o">&gt;/</span>
        <span class="n">current</span><span class="o">/</span>
            <span class="n">event</span><span class="o">.</span><span class="n">xml</span>
            <span class="o">*</span><span class="n">_dat</span><span class="o">.</span><span class="n">xml</span>
            <span class="o">*</span><span class="n">_fault</span><span class="o">.</span><span class="n">txt</span> <span class="p">(</span><span class="ow">or</span> <span class="n">rupture</span><span class="o">.</span><span class="n">json</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">conf</span> <span class="p">(</span><span class="ow">or</span> <span class="n">model_zc</span><span class="o">.</span><span class="n">conf</span><span class="p">)</span>
            <span class="n">products</span><span class="o">/</span>
                <span class="n">shake_result</span><span class="o">.</span><span class="n">hdf</span>
                <span class="o">...</span>
        <span class="n">shake</span><span class="o">.</span><span class="n">log</span>
        <span class="o">.</span><span class="n">backup0001</span><span class="o">/</span>
            <span class="n">event</span><span class="o">.</span><span class="n">xml</span>
            <span class="o">...</span>
        <span class="o">.</span><span class="n">backup0002</span><span class="o">/</span>
            <span class="o">...</span>
        <span class="o">...</span>
    <span class="o">&lt;</span><span class="n">event_id_2</span><span class="o">&gt;/</span>
        <span class="o">...</span>
    <span class="o">&lt;</span><span class="n">event_id_3</span><span class="o">&gt;/</span>
        <span class="o">...</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The ‘install’ directory (‘&lt;install_dir&gt;’) holds configuration files and
user supplied geographic or other system specific data:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">install_dir</span><span class="o">&gt;/</span>
    <span class="n">config</span><span class="o">/</span>
        <span class="n">model</span><span class="o">.</span><span class="n">conf</span>
        <span class="n">modules</span><span class="o">.</span><span class="n">conf</span>
        <span class="n">gmpe_sets</span><span class="o">.</span><span class="n">conf</span>
        <span class="o">...</span>
    <span class="n">site_data</span><span class="o">/</span>
        <span class="n">vs30</span><span class="o">.</span><span class="n">grid</span>
    <span class="n">logs</span><span class="o">/</span>
        <span class="n">shake</span><span class="o">.</span><span class="n">log</span>
        <span class="n">shake</span><span class="o">.</span><span class="n">log</span><span class="o">.&lt;</span><span class="n">timestamp</span><span class="o">&gt;</span>
        <span class="o">...</span>
    <span class="o">&lt;</span><span class="n">other_directory</span><span class="o">&gt;/</span>
        <span class="p">(</span><span class="n">additional</span> <span class="n">data</span> <span class="n">files</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Macros within the configuration system allow the user to specify the
root data and install directories when setting configuration
parameters.</p>
<p>The user may have more than one profile, and can switch between them with
<strong>sm_profile</strong>. This allows the user to have different configurations
and data repositories for different event sets (e.g., real time events,
scenarios, and historic events). See the
<a class="reference internal" href="../programs/sm_profile.html#sm-profile"><span class="std std-ref">sm_profile man page</span></a> for usage and a list of options.</p>
</div>
<div class="section" id="shake">
<h3>2.1.2.2. shake<a class="headerlink" href="#shake" title="Permalink to this headline">¶</a></h3>
<p>The primary ShakeMap program is called <strong>shake</strong>. It takes an event
ID and a list of modules as arguments. The modules do the work of
assembling the input data, producing interpolated grids, and deriving
products from the grids and associated metadata. See the
<a class="reference internal" href="../programs/shake.html#shake"><span class="std std-ref">shake man page</span></a> or run <code class="docutils literal"><span class="pre">shake</span> <span class="pre">--help</span></code> for a list
of available modules.  Each of the modules may have
its own command-line options; run “shake help MODULE” to see the help
for a given module.</p>
<p>The behavior of <strong>shake</strong> and some of its modules are controlled by
the configuration files <em>shake.conf</em> and <em>products.conf</em>. <em>shake.conf</em>
is largely concerned with the way logging is handled. See <em>shake.conf</em>
for details. <em>products.conf</em> controls the behavior of some of the
core modules that produce ShakeMap products. See the documentation
within the file for more information. Both files should be in the
user’s current profile’s <em>INSTALL_DIR/config</em> directory.</p>
</div>
<div class="section" id="shake-modules">
<h3>2.1.2.3. shake Modules<a class="headerlink" href="#shake-modules" title="Permalink to this headline">¶</a></h3>
<p>Below is a description of many of the modules available to <strong>shake</strong>.
They are ordered in more or less the order they would be called. The
module <strong>select</strong> would be run first if the operator wanted to have
the ShakeMap system determine the GMPE sets to use based on the
event’s location and depth. Many operators will have a fixed
configuration for their GMPEs, and will therefore not use <strong>select</strong>.
The operator will then typically run <strong>assemble</strong> or <strong>augment</strong>, to
create (or update) the <em>shake_data.hdf</em> input file,
followed by <strong>model</strong>. The order of modules after <strong>model</strong> is
usually not important as they typically depend upon the output of
<strong>model</strong> (i.e., <em>shake_result.hdf</em>) and not upon the results of
other modules.</p>
<div class="section" id="select">
<h4>2.1.2.3.1. select<a class="headerlink" href="#select" title="Permalink to this headline">¶</a></h4>
<p><strong>select</strong> reads an event’s <em>event.xml</em> file for origin information
and then constructs a GMPE set for the event based on the event’s residence
within,
and proximity to, a set of predefined tectonic regions and user-defined
geographic areas. The GMPE set, and the
selection of that GMPE set for use in processing, are written to
<em>model_zc.conf</em> in the event’s <em>current</em> directory.</p>
<p>The behavior of <strong>select</strong> is controlled by the <em>select.conf</em>
configuration file. See the documentation in <em>select.conf</em> for more on
customizing <strong>select</strong>.</p>
<p>The tectonic regions, and additional geographic layers, that the event
may fall within are defined by the STREC configuration. See the STREC
documentation for information on adding additional layers, then use
<em>select.conf</em> to customize the GMPE sets that the new layers will use.</p>
<p>The process by which sm_select builds a GMPE set is somewhat complicated.
STREC reports the tectonic region the earthquake lies within, as well
as the distance to the closest polygon of the other tectonic region
types. For example, for an earthquake in California STREC would report
that the event was zero distance from region ‘acr’
(which is to say that it lies within the active crustal region), but
STREC would also report distances to regions ‘scr’ (stable continental),
‘volcanic’, and ‘subduction’. Each non-subduction region is also
configured with a “horizontal buffer.” The buffer determines how far
the region extends into neighboring regions. The buffer for subduction
regions is always zero.<a class="footnote-reference" href="#fn1" id="id1">[1]</a> If the event happens within the buffer
of a neighboring region, the distance and buffer are used to build a
weighted combination of the GMPE sets representing the regions in
question.</p>
<p>For example, if an earthquake occurred within the ‘scr’ region, but
was 40 km from the “acr” region, and the ‘acr’ region’s horizontal
buffer was 100 km, then the ‘scr’ region would be given a weight
of 1.0, and the ‘acr’ region would be given (100 - 40) / 100 = 0.6.
Normalizing
by the total, the final weights would be 0.625 ‘scr’ and 0.375 ‘acr’.</p>
<p>Each region’s GMPE set is in turn comprised of a weighted set of other
GMPE sets, based on the earthquake’s depth. For each of the non-subduction
regions,
<strong>select</strong> builds a weighted combination of the configured GMPE sets
based on the event’s depth. If the earthquake falls within a subduction
region, STREC
reports the probabilities that the earthquake is crustal, on the
subduction interface, or within the subducting slab. <strong>select</strong>
combines the GMPE sets for each of these regimes, weighted by their
probabilities, into a subduction GMPE set that is specific to the
earthquake’s location.</p>
<p><strong>select</strong> also considers the earthquake’s presence within, or
distance from,
any number of user-defined geographic layers. If the earthquake is
within a layer, that layer’s
parameters (as configured in <em>select.conf</em>) replace the any or all
of the parameters of the corresponding tectonic regions, and the
calculation of a weighted GMPE set proceeds as before. For example,
the layer section of <em>select.conf</em> might contain:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">layers</span><span class="p">]</span>
    <span class="p">[[</span><span class="n">california</span><span class="p">]]</span>
        <span class="n">horizontal_buffer</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="p">[[[</span><span class="n">scr</span><span class="p">]]</span>
            <span class="n">horizontal_buffer</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="p">[[[</span><span class="n">acr</span><span class="p">]]]</span>
            <span class="n">horizontal_buffer</span> <span class="o">=</span> <span class="mi">25</span>
            <span class="n">gmpe</span> <span class="o">=</span> <span class="n">Special_California_GMPE</span>
            <span class="n">min_depth</span> <span class="o">=</span> <span class="o">-</span><span class="n">Inf</span>
            <span class="n">max_depth</span> <span class="o">=</span> <span class="n">Inf</span>
</pre></div>
</div>
<p>If an earthquake falls within the ‘california’ layer, the tectonc regions
‘scr’ and ‘acr’ would have their horizontal buffers reset to 25 km and,
in addition, the ‘acr’ region would have its GMPE selection reset to the
GMPE set ‘Special_California_GMPE’ for earthquakes of all depths.</p>
<p>If the
earthquake is not inside a custom geographic layer, but within the horizontal
buffer distance of one, the
GMPE sets for the modified and unmodified tectonic regions are each
determined separately
and a weighted combination of the two is computed (where the weights
are based on the distance and the horizontal buffer, as described
above).</p>
<p>Unlike the tectonic regions, the geographic layers consider only the
nearest layer. If an earthquake falls
within more than one layer (possible if layers are nested), the first one
encountered in the <em>select.conf</em> is used and any other(s) will be ignored.</p>
<p>See <a class="reference internal" href="../apidoc/shakemap.coremods.select.html#module-shakemap.coremods.select" title="shakemap.coremods.select"><code class="xref py py-meth docutils literal"><span class="pre">shakemap.coremods.select()</span></code></a> for the module’s API
documentation.</p>
</div>
<div class="section" id="dyfi">
<h4>2.1.2.3.2. dyfi<a class="headerlink" href="#dyfi" title="Permalink to this headline">¶</a></h4>
<p>The <strong>dyfi</strong> module queries ComCat for any “Did You Feel It?” data
associated with an event and writes that data to a file in the event’s
<em>current</em> directory.</p>
<p>See <a class="reference internal" href="../apidoc/shakemap.coremods.dyfi.html#module-shakemap.coremods.dyfi" title="shakemap.coremods.dyfi"><code class="xref py py-meth docutils literal"><span class="pre">shakemap.coremods.dyfi()</span></code></a> for the module’s API
documentation.</p>
</div>
<div class="section" id="assemble">
<h4>2.1.2.3.3. assemble<a class="headerlink" href="#assemble" title="Permalink to this headline">¶</a></h4>
<p>The <strong>assemble</strong> module collects event and configuration data and creates the
file <em>shake_data.hdf</em>. It first reads <em>event.xml</em> and stores it in a
data structure. <strong>sm_assemble</strong> then reads the configuration files</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">install_dir</span><span class="o">&gt;/</span><span class="n">modules</span><span class="o">.</span><span class="n">conf</span>
<span class="o">&lt;</span><span class="n">install_dir</span><span class="o">&gt;/</span><span class="n">gmpe_sets</span><span class="o">.</span><span class="n">conf</span>
<span class="o">&lt;</span><span class="n">install_dir</span><span class="o">&gt;/</span><span class="n">model</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
<p>and assembles them into a single configuration. It then reads</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">data_dir</span><span class="o">&gt;/&lt;</span><span class="n">evnt_id</span><span class="o">&gt;/</span><span class="n">current</span><span class="o">&gt;/</span><span class="n">model</span><span class="o">.</span><span class="n">conf</span> <span class="p">(</span><span class="ow">or</span> <span class="n">model_zc</span><span class="o">.</span><span class="n">conf</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<p>Any parameter set in the event-specific <em>model.conf</em> will override
parameters set in the other configuration files. Note: if both
<em>model.conf</em> and <em>model_zc.conf</em> exist in the event directory,
<em>model.conf</em> will be processed and <em>model_zc.conf</em> will be ignored.</p>
<p><strong>assemble</strong> then reads any files with a <em>_dat.xml</em> extension
and assembles them into a station list. See ??? for a description
of the data file format. Similarly, <strong>assmeble</strong> will read a
file with the <em>_fault.txt</em> (or <em>_fault.json</em>) extension and
process it as a specification of a finite rupture. See ??? for
a description of the rupture file formats. Note: only one rupture
file should be present in the event’s input directory. If more
than one file exists, only the first (lexicographically) will we
processed.</p>
<p>If no backups exist (i.e., event subdirectories named <em>.backup????</em>)
then the ShakeMap history from an existing <em>shake_data.hdf</em> is
extracted and updated. If there is no current <em>shake_data.hdf</em>, the
history for the event is initiated. If backups do exist, then the
history is extracted from the most current backup and appended
with the current timestamp, originator, and version.</p>
<p><strong>assemble</strong> then consolidated all of this data and writes
<em>shake_data.hdf</em> in the event’s <em>current</em> directory. If <em>shake_data.hdf</em>
already exists in that location, it will be overwritten.</p>
<p><strong>assemble</strong> takes an optional command-line argument (<code class="docutils literal"><span class="pre">-c</span> <span class="pre">COMMENT</span></code>
or <code class="docutils literal"><span class="pre">--comment</span> <span class="pre">COMMENT</span></code>) to provide a comment
that will be added to the history for the
current version of the event’s ShakeMap. If run from a terminal,
and a comment is not provided on the command line, <strong>assemble</strong>
will prompt the user for a comment.
Run “shake help assemble” for more.</p>
<p>See <a class="reference internal" href="../apidoc/shakemap.coremods.assemble.html#module-shakemap.coremods.assemble" title="shakemap.coremods.assemble"><code class="xref py py-meth docutils literal"><span class="pre">shakemap.coremods.assemble()</span></code></a> for the module’s API
documentation.</p>
<div class="figure align-left" id="id5">
<span id="shake-assemble"></span><a class="reference internal image-reference" href="../_images/assemble.png"><img alt="../_images/assemble.png" src="../_images/assemble.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-text">Figure 4: Data flow of the <em>assemble</em> module.</span></p>
</div>
</div>
<div class="section" id="augment">
<h4>2.1.2.3.4. augment<a class="headerlink" href="#augment" title="Permalink to this headline">¶</a></h4>
<p>The <strong>augment</strong> module behaves very similarly to <strong>assemble</strong> except that it
will first read <em>shake_data.hdf</em> from the event’s <em>current</em> directory.
If <em>exven.xml</em> exists in the event’s <em>current</em> directory, its data will
replace the data in the existing <em>shake_data.hdf</em>.</p>
<p>The configuration data in <em>shake_data.hdf</em> is used as a starting point,
and any configuration data from the system configuration files or the
event’s <em>model.conf</em> (or <em>model_zc.conf</em>) will then be added to it. Where
there are conflicts, the system configuration parameters will override
those found in <em>shake_data.hdf</em>. The event-specific configuration
parameters from the local system retain the highest priority.</p>
<p>Data files (i.e., files in the event’s <em>current</em> directory that have
the <em>_dat.xml</em> extension) will be added to any data already found in
<em>shake_data.hdf</em>. If a fault file is found in the local directory, it
will replace the existing fault data in <em>shake_data.hdf</em>.</p>
<p>The history information will be updated to reflect the update time and
originator (if applicable).</p>
<p>As with <strong>assemble</strong>, <strong>augment</strong> takes an optional command-line
argument (<code class="docutils literal"><span class="pre">-c</span> <span class="pre">COMMENT</span></code>
or <code class="docutils literal"><span class="pre">--comment</span> <span class="pre">COMMENT</span></code>) to provide a comment
that will be added to the history for the
current version of the event’s ShakeMap. If run from a terminal,
and a comment is not provided on the command line, <strong>assemble</strong>
will prompt the user for a comment.
Run “shake help augment” for more.</p>
<p>See <a class="reference internal" href="../apidoc/shakemap.coremods.augment.html#module-shakemap.coremods.augment" title="shakemap.coremods.augment"><code class="xref py py-meth docutils literal"><span class="pre">shakemap.coremods.augment()</span></code></a> for the module’s API
documentation.</p>
</div>
<div class="section" id="model">
<h4>2.1.2.3.5. model<a class="headerlink" href="#model" title="Permalink to this headline">¶</a></h4>
<p>The <strong>model</strong> module reads the data in <em>shake_data.hdf</em> and produces an
interpolated ShakeMap. Depending upon the settings found in <em>model.conf</em>,
the interpolation product may be a grid or a set of points. See
<em>model.conf</em> for additional options and documentation. The <em>model.conf</em>
file in the user’s current profile (i.e., <em>INSTALL_DIR/config/model.conf</em>)
will be read first, and then if <em>model.conf</em> or <em>model_zc.conf</em> exists
in the event’s <em>current</em> directory, then the parameters set therein will
override those in the profile’s <em>model.conf</em>. If both <em>model.conf</em> and
<em>model_zc.conf</em> exist in the event’s <em>current</em> directory, <em>model.conf</em>
will be read and <em>model_zc.conf</em> will be ignored. <strong>model</strong> also reads
the configuration files <em>gmpe_sets.conf</em> and <em>modules.conf</em>, which
reside in the current profile’s <em>INSTALL_DIR/config</em> directory. See
the documentation within those files for more information.</p>
<p>A great deal of this manual is devoted to the way the interpolation is
performed, and the effect of various configuration options. See the
relevant sections for more. In particular, the section <a class="reference internal" href="tg_processing.html#sec-processing-4"><span class="std std-ref">Data Processing</span></a>
goes into detail on the way the model program works.</p>
<p><strong>model</strong> writes a file, <em>shake_result.hdf</em>, in the <em>products</em>
subdirectory of the event’s <em>current</em> directory.
See <a class="reference internal" href="tg_formats.html#sec-formats-4"><span class="std std-ref">the formats section</span></a>
of this manual for more on the format and
content of <em>shake_result.hdf</em>.</p>
<p>See <a class="reference internal" href="../apidoc/shakemap.coremods.model.html#module-shakemap.coremods.model" title="shakemap.coremods.model"><code class="xref py py-meth docutils literal"><span class="pre">shakemap.coremods.model()</span></code></a> for the module’s API
documentation.</p>
</div>
<div class="section" id="contour">
<h4>2.1.2.3.6. contour<a class="headerlink" href="#contour" title="Permalink to this headline">¶</a></h4>
<p><strong>contour</strong> reads an event’s <em>shake_result.hdf</em> and produces iso-seismal
contours for each of the intensity measure types found therein. The contours
are written as GeoJSON to files called <em>&lt;imt_type&gt;_cont.json</em> in the event’s
<em>current/products</em> subdirectory.</p>
<p>See <a class="reference internal" href="../apidoc/shakemap.coremods.contour.html#module-shakemap.coremods.contour" title="shakemap.coremods.contour"><code class="xref py py-meth docutils literal"><span class="pre">shakemap.coremods.contour()</span></code></a> for the module’s API documentation..</p>
</div>
<div class="section" id="gridxml">
<h4>2.1.2.3.7. gridxml<a class="headerlink" href="#gridxml" title="Permalink to this headline">¶</a></h4>
<p><strong>gridxml</strong> reads an event’s <em>shake_result.hdf</em> and produces the ShakeMap 3.5
files <em>grid.xml</em> and <em>uncertainty.xml</em>. Note that these files will eventually
become deprecated in favor of the new <em>shake_result.hdf</em> file.
See the products section of this manual for more on these files.
Note that the use of these files is
deprecated. System designers should extract the relevant information
directly from <em>shake_result.hdf</em>. See <a class="reference internal" href="tg_formats.html#sec-formats-4"><span class="std std-ref">the formats section</span></a>
of this manual for more on
using <em>shake_result.hdf</em>.</p>
<p>See <a class="reference internal" href="../apidoc/shakemap.coremods.gridxml.html#module-shakemap.coremods.gridxml" title="shakemap.coremods.gridxml"><code class="xref py py-meth docutils literal"><span class="pre">shakemap.coremods.gridxml()</span></code></a> for the module’s API
documentation.</p>
</div>
<div class="section" id="info">
<h4>2.1.2.3.8. info<a class="headerlink" href="#info" title="Permalink to this headline">¶</a></h4>
<p><strong>info</strong> reads an event’s <em>shake_result.hdf</em> and produces <em>info.json</em>,
which contains metadata about the ShakeMap.</p>
<p>See <a class="reference internal" href="../apidoc/shakemap.coremods.info.html#module-shakemap.coremods.info" title="shakemap.coremods.info"><code class="xref py py-meth docutils literal"><span class="pre">shakemap.coremods.info()</span></code></a> for the module’s API
documentation.</p>
</div>
<div class="section" id="mapping">
<h4>2.1.2.3.9. mapping<a class="headerlink" href="#mapping" title="Permalink to this headline">¶</a></h4>
<p><strong>mapping</strong> reads an event’s <em>shake_result.hdf</em> and produces a set of
maps of the IMTs for use in quality control and evaluation of the
performance of the system. Currently, this module is a placeholder
for basic visualization purposes. It does not produce reliable
production-ready maps, equivalent of ShakeMap 3.5’s static maps,
and we may not maintain or support it in its current form in the
future. In particular, it uses the <strong>basemap</strong> mapping package,
which is disappearing in favor of <strong>cartopy</strong>.</p>
<p>See <a class="reference internal" href="../apidoc/shakemap.coremods.mapping.html#module-shakemap.coremods.mapping" title="shakemap.coremods.mapping"><code class="xref py py-meth docutils literal"><span class="pre">shakemap.coremods.mapping()</span></code></a> for the module’s API
documentation. See the
configuration file <em>products.conf</em> for information on configuring
the <strong>mapping</strong> module.</p>
</div>
<div class="section" id="plotregr">
<h4>2.1.2.3.10. plotregr<a class="headerlink" href="#plotregr" title="Permalink to this headline">¶</a></h4>
<p><strong>plotregr</strong> makes plots of an approximation of the GMPE’s predicted
ground motion as a function of distance for each
output IMT, along with the data for that IMT. The plotted value at each
distance is the average value of the GMPE’s gridded values in that
particular distance bin. The values are predicted on soil (Vs30=180 m/s)
and rock (Vs30=760 m/s), which are plotted as green and red lines,
respectively. The +/- 1 standard deviation lines are also plotted.
The station and dyfi data are plotted at their
computed distance from the source. If no finite fault is available for
the map, then the approximated point-source to finite-fault  distance
is used.</p>
<p>The <strong>plotregr</strong> module is fairly simplistic and of limited utility.
Our hope it that it will be rendered obsolete by
more sophisticated interactive plots.</p>
</div>
<div class="section" id="raster">
<h4>2.1.2.3.11. raster<a class="headerlink" href="#raster" title="Permalink to this headline">¶</a></h4>
<p><strong>raster</strong> reads an event’s <em>shake_result.hdf</em> and produces GIS
raster files of the mean and standard deviation for each of the
IMTs in <em>shake_result.hdf</em>.</p>
<p>See <a class="reference internal" href="../apidoc/shakemap.coremods.raster.html#module-shakemap.coremods.raster" title="shakemap.coremods.raster"><code class="xref py py-meth docutils literal"><span class="pre">shakemap.coremods.raster()</span></code></a> for the module’s API
documentation.</p>
</div>
<div class="section" id="rupture">
<h4>2.1.2.3.12. rupture<a class="headerlink" href="#rupture" title="Permalink to this headline">¶</a></h4>
<p><strong>rupture</strong> reads an event’s <em>shake_result.hdf</em> and produces a
file, <em>rupture.json</em> containing the coordinates of the rupture
plane(s) supplied via the input file <em>&lt;&gt;_fault.txt</em> or <em>&lt;&gt;_fault.json</em>.</p>
<p>See <a class="reference internal" href="../apidoc/shakemap.coremods.rupture.html#module-shakemap.coremods.rupture" title="shakemap.coremods.rupture"><code class="xref py py-meth docutils literal"><span class="pre">shakemap.coremods.rupture()</span></code></a> for the module’s API
documentation.</p>
</div>
<div class="section" id="stations">
<h4>2.1.2.3.13. stations<a class="headerlink" href="#stations" title="Permalink to this headline">¶</a></h4>
<p><strong>stations</strong> reads an event’s <em>shake_result.hdf</em> and produces a
JSON file, <em>stationlist.json</em>, of the input station data.</p>
<p>See <a class="reference internal" href="../apidoc/shakemap.coremods.stations.html#module-shakemap.coremods.stations" title="shakemap.coremods.stations"><code class="xref py py-meth docutils literal"><span class="pre">shakemap.coremods.stations()</span></code></a> for the module’s API
documentation.</p>
</div>
</div>
</div>
<div class="section" id="additional-programs">
<h2>2.1.3. Additional Programs<a class="headerlink" href="#additional-programs" title="Permalink to this headline">¶</a></h2>
<p>ShakeMap provides a few auxiliary programs that may occasionally be
useful.</p>
<div class="section" id="getdyfi">
<h3>2.1.3.1. getdyfi<a class="headerlink" href="#getdyfi" title="Permalink to this headline">¶</a></h3>
<p><strong>getdyfi</strong> is a standalone program implementing the <strong>dyfi</strong> module’s
functionality.  See the <a class="reference internal" href="../programs/getdyfi.html#getdyfi"><span class="std std-ref">getdyfi man page</span></a> for usage and a
list of options.</p>
</div>
<div class="section" id="sm-clone">
<h3>2.1.3.2. sm_clone<a class="headerlink" href="#sm-clone" title="Permalink to this headline">¶</a></h3>
<p><strong>sm_clone</strong> queries the NEIC ComCat database for ShakeMap data
associated with an event and writes that data into the event’s
local <em>current</em> directory. The event will then be available for
local processing.</p>
<p>See the <a class="reference internal" href="../programs/sm_clone.html#sm-clone"><span class="std std-ref">sm_clone man page</span></a> for usage and a
list of options.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="fn1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Subduction regions do not extend beyond their defined boundaries
because STREC cannot provide the crustal, interface,
and slab probabilities for events outside of the defined subduction
zones.</td></tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/northridge_thumbnail_light_16x9.png" alt="Logo"/>
    
    <h1 class="logo logo-name">ShakeMap Documentation</h1>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../manual3_5/index.html">ShakeMap 3.5 Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="title_page.html">ShakeMap 4 Manual</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Table of Contents</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="technical_guide.html">2. Technical Guide</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">2.1. Software Architecture</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#overview">2.1.1. Overview</a></li>
<li class="toctree-l5"><a class="reference internal" href="#programs">2.1.2. Programs</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#sm-profile">2.1.2.1. sm_profile</a></li>
<li class="toctree-l6"><a class="reference internal" href="#shake">2.1.2.2. shake</a></li>
<li class="toctree-l6"><a class="reference internal" href="#shake-modules">2.1.2.3. shake Modules</a><ul>
<li class="toctree-l7"><a class="reference internal" href="#select">2.1.2.3.1. select</a></li>
<li class="toctree-l7"><a class="reference internal" href="#dyfi">2.1.2.3.2. dyfi</a></li>
<li class="toctree-l7"><a class="reference internal" href="#assemble">2.1.2.3.3. assemble</a></li>
<li class="toctree-l7"><a class="reference internal" href="#augment">2.1.2.3.4. augment</a></li>
<li class="toctree-l7"><a class="reference internal" href="#model">2.1.2.3.5. model</a></li>
<li class="toctree-l7"><a class="reference internal" href="#contour">2.1.2.3.6. contour</a></li>
<li class="toctree-l7"><a class="reference internal" href="#gridxml">2.1.2.3.7. gridxml</a></li>
<li class="toctree-l7"><a class="reference internal" href="#info">2.1.2.3.8. info</a></li>
<li class="toctree-l7"><a class="reference internal" href="#mapping">2.1.2.3.9. mapping</a></li>
<li class="toctree-l7"><a class="reference internal" href="#plotregr">2.1.2.3.10. plotregr</a></li>
<li class="toctree-l7"><a class="reference internal" href="#raster">2.1.2.3.11. raster</a></li>
<li class="toctree-l7"><a class="reference internal" href="#rupture">2.1.2.3.12. rupture</a></li>
<li class="toctree-l7"><a class="reference internal" href="#stations">2.1.2.3.13. stations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#additional-programs">2.1.3. Additional Programs</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#getdyfi">2.1.3.1. getdyfi</a></li>
<li class="toctree-l6"><a class="reference internal" href="#sm-clone">2.1.3.2. sm_clone</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="tg_processing.html">2.2. Data Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="tg_formats.html">2.3. Data Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="tg_validation.html">2.4. Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="tg_contributing.html">2.5. Guidelines for Contributors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="references.html">3. References &amp; Bibliography</a></li>
<li class="toctree-l3"><a class="reference internal" href="glossary.html">4. Glossary</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../programs/programs.html">ShakeMap 4.0a Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/shakemap.html">ShakeMap 4.0a API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shakelib/shakelib.html">ShakeLib API</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
    </div>

    

    
  </body>
</html>