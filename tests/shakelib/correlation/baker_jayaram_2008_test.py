#!/usr/bin/env python
import numpy as np

from shakelib.correlation.baker_jayaram_2008 import baker_jayaram_correlation


def test_baker_jayaram_2008():
    pp = np.logspace(-2.0, 1.0, 20)

    outgrid = np.full((20, 20), np.nan)
    for i, pp1 in enumerate(pp):
        for j, pp2 in enumerate(pp):
            outgrid[i, j] = baker_jayaram_correlation(pp1, pp2)

    assert(np.max(outgrid) == 1)
    assert(np.min(outgrid) >= 0)
    assert((outgrid.transpose() == outgrid).all())

    reference = np.array(
      [[1.00000000e+00, 9.97165517e-01, 9.94731150e-01, 9.87803775e-01,
        9.65697461e-01, 9.20243648e-01, 8.97300008e-01, 8.95134839e-01,
        8.95060725e-01, 8.23052490e-01, 7.43982951e-01, 6.61833059e-01,
        5.76997817e-01, 4.89881423e-01, 4.00894973e-01, 3.10454190e-01,
        2.18977194e-01, 1.26882336e-01, 3.45861070e-02, 5.76413915e-02],
       [9.97165517e-01, 1.00000000e+00, 9.96891888e-01, 9.90509485e-01,
        9.70280948e-01, 9.27022612e-01, 9.03029834e-01, 8.99050287e-01,
        8.96710843e-01, 8.19928907e-01, 7.39884641e-01, 6.57001296e-01,
        5.71710308e-01, 4.84448250e-01, 3.95653852e-01, 3.05765131e-01,
        2.15216653e-01, 1.24436962e-01, 3.38461890e-02, 5.64388663e-02],
       [9.94731150e-01, 9.96891888e-01, 1.00000000e+00, 9.94401513e-01,
        9.76874064e-01, 9.36773812e-01, 9.11271902e-01, 9.04682461e-01,
        8.92773158e-01, 8.13612728e-01, 7.31597474e-01, 6.47231017e-01,
        5.61018469e-01, 4.73461866e-01, 3.85055816e-01, 2.96283416e-01,
        2.07612490e-01, 1.19492189e-01, 3.23500055e-02, 5.40072480e-02],
       [9.87803775e-01, 9.90509485e-01, 9.94401513e-01, 1.00000000e+00,
        9.86357932e-01, 9.50800424e-01, 9.23127703e-01, 9.12784062e-01,
        8.85009257e-01, 8.01159173e-01, 7.15257739e-01, 6.27967045e-01,
        5.39937464e-01, 4.51800108e-01, 3.64159759e-01, 2.77588401e-01,
        1.92619426e-01, 1.09742622e-01, 2.93999934e-02, 4.92128473e-02],
       [9.65697461e-01, 9.70280948e-01, 9.76874064e-01, 9.86357932e-01,
        1.00000000e+00, 9.70977003e-01, 9.40181679e-01, 9.24437810e-01,
        8.70514076e-01, 7.77908421e-01, 6.84751500e-01, 5.92001261e-01,
        5.00579286e-01, 4.11357666e-01, 3.25146879e-01, 2.42684858e-01,
        1.64627416e-01, 9.15402085e-02, 2.38923291e-02, 4.02617144e-02],
       [9.20243648e-01, 9.27022612e-01, 9.36773812e-01, 9.50800424e-01,
        9.70977003e-01, 1.00000000e+00, 9.64712969e-01, 9.41201141e-01,
        8.46624401e-01, 7.39588589e-01, 6.34473814e-01, 5.32725639e-01,
        4.35712619e-01, 3.44704011e-01, 2.60849303e-01, 1.85159928e-01,
        1.18493464e-01, 6.15406004e-02, 1.48150841e-02, 2.55092492e-02],
       [8.97300008e-01, 9.03029834e-01, 9.11271902e-01, 9.23127703e-01,
        9.40181679e-01, 9.64712969e-01, 1.00000000e+00, 9.45228569e-01,
        8.18443462e-01, 6.94385427e-01, 5.75164829e-01, 4.62802432e-01,
        3.59194057e-01, 2.66077467e-01, 1.85002055e-01, 1.17301886e-01,
        6.40725433e-02, 2.61522108e-02, 4.10730811e-03, 8.10682223e-03],
       [8.95134839e-01, 8.99050287e-01, 9.04682461e-01, 9.12784062e-01,
        9.24437810e-01, 9.41201141e-01, 9.45228569e-01, 1.00000000e+00,
        8.67327155e-01, 7.36999996e-01, 6.11322739e-01, 4.92517385e-01,
        3.82684441e-01, 2.83765780e-01, 1.97510305e-01, 1.25443034e-01,
        6.88381323e-02, 2.86963882e-02, 5.72751673e-03, 3.37612964e-04],
       [8.95060725e-01, 8.96710843e-01, 8.92773158e-01, 8.85009257e-01,
        8.70514076e-01, 8.46624401e-01, 8.18443462e-01, 8.67327155e-01,
        1.00000000e+00, 8.67327155e-01, 7.36999996e-01, 6.11322739e-01,
        4.92517385e-01, 3.82684441e-01, 2.83765780e-01, 1.97510305e-01,
        1.25443034e-01, 6.88381323e-02, 2.86963882e-02, 5.72751673e-03],
       [8.23052490e-01, 8.19928907e-01, 8.13612728e-01, 8.01159173e-01,
        7.77908421e-01, 7.39588589e-01, 6.94385427e-01, 7.36999996e-01,
        8.67327155e-01, 1.00000000e+00, 8.67327155e-01, 7.36999996e-01,
        6.11322739e-01, 4.92517385e-01, 3.82684441e-01, 2.83765780e-01,
        1.97510305e-01, 1.25443034e-01, 6.88381323e-02, 2.86963882e-02],
       [7.43982951e-01, 7.39884641e-01, 7.31597474e-01, 7.15257739e-01,
        6.84751500e-01, 6.34473814e-01, 5.75164829e-01, 6.11322739e-01,
        7.36999996e-01, 8.67327155e-01, 1.00000000e+00, 8.67327155e-01,
        7.36999996e-01, 6.11322739e-01, 4.92517385e-01, 3.82684441e-01,
        2.83765780e-01, 1.97510305e-01, 1.25443034e-01, 6.88381323e-02],
       [6.61833059e-01, 6.57001296e-01, 6.47231017e-01, 6.27967045e-01,
        5.92001261e-01, 5.32725639e-01, 4.62802432e-01, 4.92517385e-01,
        6.11322739e-01, 7.36999996e-01, 8.67327155e-01, 1.00000000e+00,
        8.67327155e-01, 7.36999996e-01, 6.11322739e-01, 4.92517385e-01,
        3.82684441e-01, 2.83765780e-01, 1.97510305e-01, 1.25443034e-01],
       [5.76997817e-01, 5.71710308e-01, 5.61018469e-01, 5.39937464e-01,
        5.00579286e-01, 4.35712619e-01, 3.59194057e-01, 3.82684441e-01,
        4.92517385e-01, 6.11322739e-01, 7.36999996e-01, 8.67327155e-01,
        1.00000000e+00, 8.67327155e-01, 7.36999996e-01, 6.11322739e-01,
        4.92517385e-01, 3.82684441e-01, 2.83765780e-01, 1.97510305e-01],
       [4.89881423e-01, 4.84448250e-01, 4.73461866e-01, 4.51800108e-01,
        4.11357666e-01, 3.44704011e-01, 2.66077467e-01, 2.83765780e-01,
        3.82684441e-01, 4.92517385e-01, 6.11322739e-01, 7.36999996e-01,
        8.67327155e-01, 1.00000000e+00, 8.67327155e-01, 7.36999996e-01,
        6.11322739e-01, 4.92517385e-01, 3.82684441e-01, 2.83765780e-01],
       [4.00894973e-01, 3.95653852e-01, 3.85055816e-01, 3.64159759e-01,
        3.25146879e-01, 2.60849303e-01, 1.85002055e-01, 1.97510305e-01,
        2.83765780e-01, 3.82684441e-01, 4.92517385e-01, 6.11322739e-01,
        7.36999996e-01, 8.67327155e-01, 1.00000000e+00, 8.67327155e-01,
        7.36999996e-01, 6.11322739e-01, 4.92517385e-01, 3.82684441e-01],
       [3.10454190e-01, 3.05765131e-01, 2.96283416e-01, 2.77588401e-01,
        2.42684858e-01, 1.85159928e-01, 1.17301886e-01, 1.25443034e-01,
        1.97510305e-01, 2.83765780e-01, 3.82684441e-01, 4.92517385e-01,
        6.11322739e-01, 7.36999996e-01, 8.67327155e-01, 1.00000000e+00,
        8.67327155e-01, 7.36999996e-01, 6.11322739e-01, 4.92517385e-01],
       [2.18977194e-01, 2.15216653e-01, 2.07612490e-01, 1.92619426e-01,
        1.64627416e-01, 1.18493464e-01, 6.40725433e-02, 6.88381323e-02,
        1.25443034e-01, 1.97510305e-01, 2.83765780e-01, 3.82684441e-01,
        4.92517385e-01, 6.11322739e-01, 7.36999996e-01, 8.67327155e-01,
        1.00000000e+00, 8.67327155e-01, 7.36999996e-01, 6.11322739e-01],
       [1.26882336e-01, 1.24436962e-01, 1.19492189e-01, 1.09742622e-01,
        9.15402085e-02, 6.15406004e-02, 2.61522108e-02, 2.86963882e-02,
        6.88381323e-02, 1.25443034e-01, 1.97510305e-01, 2.83765780e-01,
        3.82684441e-01, 4.92517385e-01, 6.11322739e-01, 7.36999996e-01,
        8.67327155e-01, 1.00000000e+00, 8.67327155e-01, 7.36999996e-01],
       [3.45861070e-02, 3.38461890e-02, 3.23500055e-02, 2.93999934e-02,
        2.38923291e-02, 1.48150841e-02, 4.10730811e-03, 5.72751673e-03,
        2.86963882e-02, 6.88381323e-02, 1.25443034e-01, 1.97510305e-01,
        2.83765780e-01, 3.82684441e-01, 4.92517385e-01, 6.11322739e-01,
        7.36999996e-01, 8.67327155e-01, 1.00000000e+00, 8.67327155e-01],
       [5.76413915e-02, 5.64388663e-02, 5.40072480e-02, 4.92128473e-02,
        4.02617144e-02, 2.55092492e-02, 8.10682223e-03, 3.37612964e-04,
        5.72751673e-03, 2.86963882e-02, 6.88381323e-02, 1.25443034e-01,
        1.97510305e-01, 2.83765780e-01, 3.82684441e-01, 4.92517385e-01,
        6.11322739e-01, 7.36999996e-01, 8.67327155e-01, 1.00000000e+00]])

    assert np.allclose(outgrid, reference)


if __name__ == '__main__':
    test_baker_jayaram_2008()
